### 📍 概况

utils/

├── password.go   # 密码相关操作

├── jwt.go        # JWT Token 相关操作

└── response.go   # 统一格式的 JSON 响应

---

## 🔐 1. password.go - 密码工具

目的： 处理密码的加密和验证

### HashPassword 函数

做什么： 把明文密码加密成哈希值

明文密码：123456

    ↓ 通过 bcrypt 加密

加密后：$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcg7b3XeKeUxWdeS86E36aiYjFm

为什么需要？

- 数据库中不能存明文密码（太危险）

- bcrypt 是单向加密（无法从哈希值反推出密码）

- 即使数据库被黑客拿到，密码也是安全的

什么时候用？

- 用户注册时

- 用户修改密码时

### CheckPassword 函数

做什么： 验证用户输入的密码是否与数据库中的哈希值匹配

用户输入：123456

已存储的哈希值：$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcg7b3XeKeUxWdeS86E36aiYjFm

    ↓ 比对

结果：✅ 密码正确 或 ❌ 密码错误

为什么需要？

- 不能直接比对明文密码

- 需要用 bcrypt 的比对算法来验证

什么时候用？

- 用户登录时

---

## 🔑 2. jwt.go - JWT Token 工具

目的： 处理用户身份认证的 Token

### 什么是 JWT？

JWT = JSON Web Token，是一种用户身份凭证

登录流程：

用户名 + 密码 ✅ 验证成功

    ↓

生成 JWT Token

    ↓

返回给前端 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

    ↓

前端存储这个 Token

    ↓

后续请求都带上这个 Token

    ↓

服务器验证 Token

    ↓

如果 Token 有效，允许操作；如果无效或过期，拒绝请求

### GenerateToken 函数

做什么： 生成一个 JWT Token

输入： 用户 ID（如 1）

输出： 一个很长的字符串（Token）

GenerateToken(1)

    ↓

生成的 Token 包含：

- 用户 ID: 1

- 签发时间: 现在

- 过期时间: 24小时后

- 签名: 用密钥生成的签名（防止篡改）

    ↓

返回：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

什么时候用？

- 用户登录成功后，返回给客户端

### ValidateToken 函数

做什么： 验证收到的 Token 是否有效

输入： Token 字符串

输出： Token 中的信息（如用户 ID）或错误

ValidateToken(eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...)

    ↓

检查：

1. Token 是否被篡改？ ✅ 检查签名

2. Token 是否过期？ ✅ 检查过期时间

    ↓

如果都没问题，返回 Token 中的信息（如 UserID = 1）

如果有问题，返回错误信息

什么时候用？

- 处理受保护的接口（如创建文章、删除评论）时

- 中间件会调用这个函数验证用户身份

---

## 📤 3. response.go - 响应工具

目的： 让所有 API 响应格式统一

### 为什么需要？

不同的接口返回不同的格式会很混乱：

// 接口1 的响应

{"user_id": 1, "name": "Alice"}

// 接口2 的响应

{"success": true, "data": {...}}

// 接口3 的响应

{"error": "not found"}

客户端需要处理多种格式，很烦！

### Success 函数

做什么： 返回成功响应，格式统一

Success(c, 200, "用户创建成功", {

    "id": 1,

    "username": "alice"

})

    ↓

返回的 JSON：

{

    "code": 200,

    "message": "用户创建成功",

    "data": {

        "id": 1,

        "username": "alice"

    }

}

什么时候用？

- 接口成功时，用这个返回成功结果

### Error 函数

做什么： 返回错误响应，格式统一

Error(c, 404, "用户不存在")

    ↓

返回的 JSON：

{

    "code": 404,

    "message": "用户不存在"

}

什么时候用？

- 接口失败时，用这个返回错误信息

---

## 🔄 实际使用流程

### 用户注册流程

1. 客户端发送请求

   POST /api/auth/register

   {

     "username": "alice",

     "password": "123456"

   }

2. 服务器处理

   - 使用 password.HashPassword("123456")

     将密码加密成哈希值

   - 存储到数据库

3. 返回响应

   使用 response.Success() 返回

   {

     "code": 201,

     "message": "注册成功",

     "data": {

       "id": 1,

       "username": "alice"

     }

   }

### 用户登录流程

1. 客户端发送请求

   POST /api/auth/login

   {

     "username": "alice",

     "password": "123456"

   }

2. 服务器处理

   - 查找用户 alice

   - 使用 password.CheckPassword() 验证密码是否正确

3. 如果密码正确

   - 使用 jwt.GenerateToken(user.ID) 生成 Token

   - 返回 response.Success() 和 Token

4. 如果密码错误

   - 返回 response.Error() 错误信息

### 创建文章流程（需要认证）

1. 客户端发送请求

   POST /api/posts

   Header: Authorization: Bearer [Token]

   Body: {

     "title": "My Blog",

     "content": "..."

   }

2. 中间件检查

   - 使用 jwt.ValidateToken() 验证 Token

   - 如果 Token 无效，中间件返回 response.Error()

3. 如果 Token 有效

   - 服务器处理请求

   - 创建文章

   - 返回 response.Success()

---

## 📊 三个工具函数的关系

注册 / 登录

    ↓

password.go (加密或验证密码)

    ↓

jwt.go (生成或验证 Token)

    ↓

response.go (统一返回格式)

---

## ✅ 总结

| 工具文件        | 主要函数                         | 用途          |
| ----------- | ---------------------------- | ----------- |
| password.go | HashPassword, CheckPassword  | 密码安全操作      |
| jwt.go      | GenerateToken, ValidateToken | 用户身份认证      |
| response.go | Success, Error               | 统一 API 响应格式 |