## 1 概率栅格地图
 **✅ 概率 → Odds**

$$

odds(m_i)=\frac{p(m_i)}{1-p(m_i)}

$$

 **✅ Odds → Log-Odds（logit）**
定义栅格占用的 log-odds：

$$

l(m_i)=\log\frac{p(m_i)}{1-p(m_i)}

$$
符号意义：
- l>0：更可能占用
    
- l<0：更可能空闲
    
- l=0：未知（p=0.5）
    
 **✅ 观测更新公式（log-odds Bayes update）**

时刻 t 给定新观测 z_t：

$$

l_t(m_i)=l_{t-1}(m_i)+\log\frac{p(m_i\mid z_t)}{1-p(m_i\mid z_t)}-l_0(m_i)

$$
其中：
$$
l_0(m_i)=\log\frac{0.5}{0.5}=0
$$

## 2 Cartographer Occupancy Grid 更新

- 每个栅格 cell **不存 float 概率**，而存一个离散整数 `value`（约 `0~32767`）。
- 地图更新时 **不重新计算概率再量化**，而是直接更新整数值（log-odds 等价更新）：

$$
l \leftarrow l + \Delta l
$$

- Cartographer 的增量不是随便的，是由配置决定：
	hit_probability  = 0.55
	miss_probability = 0.49
### Hit（击中障碍）

$$
\Delta l_{\text{hit}}=\log\frac{p_{\text{hit}}}{1-p_{\text{hit}}}>0
$$

例如 `p_hit=0.55`：

$$
\Delta l_{\text{hit}}\approx +0.20
$$

### Miss（穿过为空）

$$
\Delta l_{\text{miss}}=\log\frac{p_{\text{miss}}}{1-p_{\text{miss}}}<0
$$

例如 `p_miss=0.49`：

$$
\Delta l_{\text{miss}}\approx -0.04
$$

- 实现上就是对 cell 的整数做快速更新：

```cpp
cell_value = clamp(cell_value + delta);
```
### **hit 比 miss 强得多**

- 打到墙一次，证据很强
    
- 穿过一次，只是轻微说明空